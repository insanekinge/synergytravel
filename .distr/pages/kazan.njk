<?php
// Load tour data for Kazan
$tourSlug = 'kazan';
$tours = [];
$tour = null;

// Load tours data
$dataPath = __DIR__ . '/blocks/tour/tours-data.json';
if (file_exists($dataPath)) {
    $json = file_get_contents($dataPath);
    $tours = json_decode($json, true) ?: [];
    
    // Find tour by slug
    foreach ($tours as $t) {
        if (isset($t['slug']) && $t['slug'] === $tourSlug) {
            $tour = $t;
            break;
        }
    }
}

$title = $tour ? $tour['title'] . ' - Synergy Travel' : 'Тур не найден';
$description = $tour ? $tour['description'] : 'Страница тура не найдена';
?>

{% extends "default.php" %}

{% block blocks %}
  {% include 'header/block.php' %}
  
  <main class="cabinet cabinet--product">
    <div class="container">

        <div class="cabinet__top">
            <a href="/" class="cabinet__top-back"><img src="img/register/arrow-back.svg" alt="" class="cabinet__top-back_img">Вернуться на главную</a>

            <h1 class="cabinet__top-title">
                <?= htmlspecialchars($tour ? $tour['title'] : 'Тур не найден') ?>
            </h1>
        </div>

        <div class="cabinet__main">

            <div class="cabinet__main-side">

                <div class="cabinet__main-side_unique">

                    <div class="cabinet__main-side_unique-top">
                        <h2 class="cabinet__main-side_unique-top_title">Уникальные рекомендации</h2>
                        <div class="cabinet__main-side_unique-top_button">Смотреть подборку<img src="img/cabinet/arrow-back.svg" alt="" class="cabinet__main-side_unique-top_button-img"></div>
                    </div>
                    <div class="cabinet__main-side_unique-bottom">

                        <p class="cabinet__main-side_unique-bottom_description">Спланируйте поездку идеально походящую именно вам</p>
                        <ul class="cabinet__main-side_unique-list">
                            <li class="cabinet__main-side_unique-list_item"><img src="img/cabinet/fisrt.svg" alt="" class="cabinet__main-side_unique-list_item-img"></li>
                            <li class="cabinet__main-side_unique-list_item"><img src="img/cabinet/second.svg" alt="" class="cabinet__main-side_unique-list_item-img"></li>
                            <li class="cabinet__main-side_unique-list_item"><img src="img/cabinet/third.svg" alt="" class="cabinet__main-side_unique-list_item-img"></li>
                        </ul>
                    </div>

                </div>

                <div class="cabinet__main-side_question">

                    <h2 class="cabinet__main-side_question-title">Есть вопросы?</h2>
                    <p class="cabinet__main-side_question-description">Свяжитесь с нашим менеджером</p>

                    <a href="" class="cabinet__main-side_question-button">Оставить заявку</a>

                </div>

            </div>

            <div class="cabinet__main-tour">
                <div class="cabinet__main-tour_top">
                    <h2 class="cabinet__main-tour_top-title">О туре</h2>
                    <div class="cabinet__main-tour_top-option">
                        <p class="cabinet__main-tour_top-option_text">Информация о выбранном путешествии</p>
                    </div>
                </div>

                <div class="cabinet__main-tour_list">
                    <?php if ($tour): ?>
                        <?php if (!empty($tour['image'])): ?>
                            <div style="width:100%;height:240px;border-radius:30px;background:#f5f5f7;background-image:url('<?= htmlspecialchars($tour['image']) ?>');background-size:cover;background-position:center;margin-bottom:20px;"></div>
                        <?php endif; ?>
                        
                        <?php if (!empty($tour['description'])): ?>
                            <p style="font-size:18px;line-height:150%;margin-bottom:16px;"><?= htmlspecialchars($tour['description']) ?></p>
                        <?php endif; ?>
                        
                        <div style="display:flex;flex-wrap:wrap;gap:10px;margin-bottom:16px;">
                            <?php if (!empty($tour['type'])): ?>
                                <div style="background:#f3f3f6;border-radius:12px;padding:10px 14px;">Тип: <?= htmlspecialchars($tour['type']) ?></div>
                            <?php endif; ?>
                            <?php if (!empty($tour['duration'])): ?>
                                <div style="background:#f3f3f6;border-radius:12px;padding:10px 14px;">Длительность: <?= htmlspecialchars($tour['duration']) ?></div>
                            <?php endif; ?>
                            <?php if (isset($tour['price'])): ?>
                                <div style="background:#f3f3f6;border-radius:12px;padding:10px 14px;">Цена: <?= number_format((float)$tour['price'], 0, '.', ' ') ?> ₽</div>
                            <?php endif; ?>
                        </div>
                        
                        <?php if (!empty($tour['details']) && is_array($tour['details'])): ?>
                            <ul style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:0;padding:0;list-style:none;">
                                <?php foreach ($tour['details'] as $detail): ?>
                                    <li style="background:#f8f8fa;border-radius:12px;padding:12px 14px;font-size:16px;"><?= htmlspecialchars($detail) ?></li>
                                <?php endforeach; ?>
                            </ul>
                        <?php endif; ?>
                    <?php else: ?>
                        <p class="cabinet__main-tour_list-title">Тур не найден</p>
                    <?php endif; ?>
                </div>
            </div>

        </div>

    </div>
  </main>
  
  {% include 'footer/block.php' %}
{% endblock %}

{% block js %}
  <script src="js/product.js"></script>
{% endblock %}
